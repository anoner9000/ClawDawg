{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://openclaw.local/schemas/team_bus.v1.json",
  "title": "OpenClaw Agent Team Bus Event (team_bus.v1)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "ts",
    "task_id",
    "agent",
    "type",
    "summary",
    "details",
    "next"
  ],
  "properties": {
    "schema_version": {
      "enum": [
        "team_bus.v1",
        "team_bus.v1.1"
      ]
    },

    "ts": {
      "type": "string",
      "description": "ISO-8601 UTC timestamp (recommended Z suffix).",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]{1,9})?Z$"
    },

    "task_id": {
      "type": "string",
      "minLength": 3,
      "maxLength": 200,
      "pattern": "^[A-Za-z0-9][A-Za-z0-9._:-]{1,199}$"
    },

    "agent": {
      "type": "string",
      "enum": [
        "deiphobe",
        "planner",
        "executor",
        "auditor",
        "watcher",
        "specialist"
      ]
    },

    "type": {
      "type": "string",
      "enum": [
        "INTENT",
        "PLAN",
        "REVIEW",
        "APPROVAL",
        "UPDATE",
        "RESULT",
        "VERIFIED",
        "RISK",
        "BLOCKED",
        "UNBLOCKED",
        "CLOSED"
      ]
    },

    "summary": {
      "type": "string",
      "minLength": 3,
      "maxLength": 500
    },

    "details": {
      "type": "object",
      "description": "Structured details. Do not include secrets or massive raw logs.",
      "additionalProperties": true
    },

    "next": {
      "type": "string",
      "minLength": 1,
      "maxLength": 300
    },

    "expires_at": {
      "type": "string",
      "description": "Optional approval expiry in ISO-8601 UTC.",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]{1,9})?Z$"
    },

    "severity": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"]
    },

    "evidence": {
      "type": "object",
      "additionalProperties": true
    }
  },

  "allOf": [
    {
      "if": { "properties": { "type": { "const": "RISK" } }, "required": ["type"] },
      "then": { "required": ["severity"] }
    },
    {
      "if": { "properties": { "type": { "const": "APPROVAL" } }, "required": ["type"] },
      "then": { "properties": { "agent": { "const": "deiphobe" } } }
    },
    {
      "if": { "properties": { "type": { "const": "RESULT" } }, "required": ["type"] },
      "then": { "properties": { "agent": { "const": "executor" } } }
    },
    {
      "if": { "properties": { "type": { "const": "VERIFIED" } }, "required": ["type"] },
      "then": { "properties": { "agent": { "const": "auditor" } } }
    },
    {
      "if": { "properties": { "type": { "const": "CLOSED" } }, "required": ["type"] },
      "then": { "properties": { "agent": { "const": "deiphobe" } } }
    },
    {
      "if": { "properties": { "type": { "const": "UNBLOCKED" } }, "required": ["type"] },
      "then": { "properties": { "agent": { "const": "deiphobe" } } }
    }
  ]
}
